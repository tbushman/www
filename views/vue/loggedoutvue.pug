script(type="text/javascript").
	Vue.prototype.$ = $;
	Vue.prototype.window = window;
	Vue.prototype.moment = moment;
	new Vue({
		el: '#vue',
		data: function data(){
			return {
				checked: false,
				user: '',
				action: '/login',
				data: this.parseObj(!{JSON.stringify(data)}),
				doc: this.parseObj(!{JSON.stringify(doc)}),
				sliderIndex: 0,
				sliderInterval: null,
				isArticleVisible: false,
				article: '',
				timeout: false,
				articleTimeout: false,
				loading: false
			}
		},
		watch: {
		},
		mounted: function(){
			var self = this;
			
			if (self.data && self.data !== '') {
				if (!self.doc || self.doc === '') {
					self.doc = self.data[0];
				}
				self.article = self.doc.category

				if (self.doc && self.doc !== '' && window.location.search.split(`?c=`)[1] && window.location.search.split(`?c=`)[1] === self.doc.category) {
					//- window.location.hash = `#${self.doc.category}`
					//- window.localStorage.setItem('_uss_hash', `#${self.doc.category}`)
					self.handleOpenArticle(self.doc.category)
					if (self.doc.category === 'donate') {
						var db = document.createElement('script');
						db.type = 'text/javascript';
						db.defer = true;
						db.src = 'https://donorbox.org/install-popup-button.js';
						var s = document.getElementsByTagName('script')[0];
						s.parentNode.insertBefore(db, s);
					}
				} 
				var length = self.doc.media.length;
				self.sliderInterval = setInterval(function(){
					if (self.sliderIndex < (length - 1)){
						self.sliderIndex++;
					} else {
						self.sliderIndex = 0;
					}
				}, 5000)

			}

		},
		methods: {
			parseObj(obj) {
				if (!obj) return '';
				return obj;
			},
			checkUser(e) {
				var self = this;
				console.log(e)
				var user = e.target.value;
				$.post('/auth/check/'+user)
				.then(function(result) {
					console.log(result)
					if (!result || result === '') {
						self.action = '/register'
					} else {
						self.action = '/login'
					}
					self.checked = true;
				})
				.catch(function(err){
					if (err) {
						self.action = '/register'
						self.checked = true
					}
				})
			},
			handleOpenArticle(article) {
				var self = this;
				
				if (/(blog)/.test(window.location.href)) {
					return window.location.href = `/?c=${article}`
				}
				
				var isArticleVisible = this.isArticleVisible
				this.isArticleVisible = !isArticleVisible;
				this.article = article;
						
				setTimeout(() => {
					var timeout = self.timeout;
					self.timeout = !timeout;
				}, 325)

				setTimeout(() => {
					var articleTimeout = self.articleTimeout;
					self.articleTimeout = !articleTimeout
				}, 350)
				//- console.log(window.location.search.split(`?c=`)[1], window.location.search.split(`?c=`)[1] === article)
				//- if (window.location.search.split(`?c=`)[1] && window.location.search.split(`?c=`)[1] === article) {
				//- 	//- window.location.hash = `#${article}`
				//- 	window.localStorage.setItem('_uss_hash', `#${article}`)
				//- } else if (window.location.hash === `#${article}`) {
				//- 
				//- } else {
				//- 	window.location.hash = `#${article}`
				//- 	window.localStorage.setItem('_uss_hash', `#${article}`)
				//- }
			},

			handleCloseArticle() {
				var self = this;
				var articleTimeout = self.articleTimeout;
				self.articleTimeout = !articleTimeout

				setTimeout(() => {
					var timeout = self.timeout;
					self.timeout = !timeout;
				}, 325)

				setTimeout(() => {
					var isArticleVisible = this.isArticleVisible
					this.isArticleVisible = !isArticleVisible;
					this.article = '';
				}, 350)
				//- window.location.search = ''
				//- window.location.hash = ''
				//- window.localStorage.setItem('_uss_hash', '')
			},

			handleClickOutside(event) {
				//- if (this.wrapperRef && !this.wrapperRef.contains(event.target)) {
					if (this.isArticleVisible) {
						this.handleCloseArticle();
					}
				//- }
			}

		}
	})
